<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html"><link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html"><link rel="import" href="../../bower_components/iron-icons/iron-icons.html"><link href="https://fonts.googleapis.com/css?family=Roboto:700" rel="stylesheet"><script src="../../node_modules/axios/dist/axios.min.js"></script></head><body><dom-module id="win-counter"><template><style>:host{font-family:'Roboto';--icon-size:60px;display:block;height:100vh;width:100vw;background-color:rgb(0,255,0);}.wrapper{display:flex;height:100%;flex-direction:column;}.title{font-size:9vw;text-align:left;vertical-align:center;flex:1;flex-grow:1;display:flex;justify-content:center;align-items:center;color:#fff;text-shadow:0px 4px 15px #000000;}.title h1{margin-left:25px;}paper-spinner{font-size:0px;}paper-dialog{width:calc(100% - 20px);max-width:600px;height:auto;word-wrap:break-word;}.error{font-size:3vw;}#copy{cursor:copy;}.ok-icon{--iron-icon-height:var(--icon-size);--iron-icon-width:var(--icon-size);}.nok-icon{--iron-icon-height:var(--icon-size);--iron-icon-width:var(--icon-size);--iron-icon-fill-color:rgb(255,0,0);}</style><div class="wrapper"><div class="title"><template is="dom-if" if="[[loading]]"><paper-spinner active=""></paper-spinner></template><template is="dom-if" if="[[!loading]]"><template is="dom-if" if="[[!error.status]]"><iron-icon class="ok-icon" icon="icons:check-circle"></iron-icon></template></template><template is="dom-if" if="[[error.status]]"><iron-icon class="nok-icon" icon="icons:cancel"></iron-icon></template><h1>WINS:</h1><template is="dom-if" if="[[!error.status]]"><template is="dom-if" if="[[!loadingMatch]]"><h1>[[wins]]</h1></template><template is="dom-if" if="[[loadingMatch]]"><paper-spinner active=""></paper-spinner></template></template><template is="dom-if" if="[[error.status]]"><template is="dom-if" if="[[!loadingMatch]]"><h1 class="error">[[error.message]]</h1></template><template is="dom-if" if="[[loadingMatch]]"><paper-spinner active=""></paper-spinner></template></template></div></div></template><script>class WinCounter extends Polymer.Element{static get is(){return"win-counter"}static get properties(){return{loading:{type:Boolean,value:!0},loadingMatch:{type:Boolean,value:!0},oldMatchId:{type:String,value:""},wins:{type:Number,value:0},initialized:{type:Boolean,value:!1},error:{type:Object,value:()=>({status:!1,message:""})}}}toUpper(a){return a.toUpperCase()}ready(){super.ready(),this.getData(),setInterval(()=>{this.getData()},2e4)}getData(){const a={headers:{Authorization:`Bearer ${this.apiKey}`,Accept:"application/vnd.api+json","Content-Type":"application/json"}};axios.get(`https://api.playbattlegrounds.com/shards/${this.region}/players?filter[playerNames]=${this.playerName}`,a).then((b)=>{console.log(b.data);let c=b.data.data[0].relationships.matches.data[0].id;this.set("error.status",!1),console.log(b.data.data[0].relationships.matches),console.log(c),console.log(this.oldMatchId),c!==this.oldMatchId&&(console.log("NEW MATCH:"),this.loading=!1,axios.get(`https://api.playbattlegrounds.com/shards/${this.region}/matches/${c}`,a).then((a)=>{let b=a.data.included.filter((a)=>"participant"===a.type&&a.attributes.stats.name===this.playerName)[0],d=b.attributes.stats.winPlace;if(this.initialized&&1===d&&(console.log("Win!"),this.wins+=1),console.log("No win :("),this.loadingMatch=!1,!this.initialized){let a=JSON.stringify({name:this.playerName});axios.post("https://pubg-win-api.herokuapp.com/api/users",a,{headers:{"Content-Type":"application/json"}}).then((a)=>{console.log(a)}).catch((a)=>{console.log(a)}),this.initialized=!0}console.log(""),this.oldMatchId=c}))}).catch((a)=>{this.set("error.status",!0),401===a.response.status?this.set("error.message","Invalid API key!"):429===a.response.status?this.set("error.message","Too many requests!"):this.set("error.message",a.response.data.errors[0].detail),this.loading=!1,this.loadingMatch=!1})}}window.customElements.define(WinCounter.is,WinCounter);</script></dom-module></body></html>